/*
 *
 * FocalTech fts TouchScreen driver.
 *
 * Copyright (c) 2012-2019, Focaltech Ltd. All rights reserved.
 *
 * This software is licensed under the terms of the GNU General Public
 * License version 2, as published by the Free Software Foundation, and
 * may be copied, distributed, and modified under those terms.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 */

/*****************************************************************************
*
* File Name: focaltech_upgrade_ft8607.c
*
* Author: Focaltech Driver Team
*
* Created: 2016-08-15
*
* Abstract:
*
* Reference:
*
*****************************************************************************/

/*****************************************************************************
* 1.Included header files
*****************************************************************************/
#include "../focaltech_flash.h"

/*****************************************************************************
* Global variable or extern global variabls/functions
*****************************************************************************/
u8 pb_file_ft8607[] = {
	0x2, 0x9, 0x7d,0xca,0x39,0x12,0xf, 0x3e,0xda,0x39,0x32,0x2, 0x0, 0x3, 0x6d,0x22,
0x80,0x13,0x75,0xb5,0x0, 0xa9,0x36,0xb3,0xfc,0xa9,0xc6,0xb3,0xe5,0xb5,0x7a,0xb, 
0xb0,0xb, 0x14,0xb, 0x24,0xbd,0x32,0x38,0xe9,0x22,0xff,0x2, 0xd, 0x65,0xa9,0xc2,
0xb4,0x74,0x5, 0x12,0xf, 0x29,0x12,0xf, 0x10,0xa9,0xd2,0xb4,0x30,0xe0,0x2, 0xd3,
0x22,0xc3,0x22,0x2, 0x0, 0xf9,0xca,0x3b,0x7a,0xd, 0x9, 0x7f,0x31,0xe5,0x23,0xb4,
0x80,0x2, 0x80,0x3, 0x2, 0x0, 0xdc,0x7f,0x13,0x5e,0x34,0x0, 0x7f,0x7d,0x23,0x7e,
0x34,0x0, 0x80,0x9d,0x32,0x7a,0x35,0xf, 0x7e,0x35,0xd, 0xbe,0x35,0xf, 0x38,0x2, 
0x80,0x5d,0x7e,0x35,0xf, 0x7a,0x35,0x11,0x7f,0x13,0x7e,0xd, 0x9, 0x12,0xb, 0xef,
0x7e,0x35,0xd, 0x9e,0x35,0xf, 0x7a,0x35,0xd, 0x7e,0x35,0xf, 0x6d,0x22,0x2f,0x31,
0x7e,0x1d,0x9, 0x2e,0x35,0xf, 0x7a,0x1d,0x9, 0x80,0x27,0x7e,0x34,0x0, 0x80,0x7a,
0x35,0x11,0x7f,0x13,0x7e,0xd, 0x9, 0x12,0xb, 0xef,0x7e,0x35,0xd, 0x9e,0x34,0x0, 
0x80,0x7a,0x35,0xd, 0x7e,0x1d,0x9, 0x2e,0x34,0x0, 0x80,0x7a,0x1d,0x9, 0x2e,0x38,
0x0, 0x80,0x7e,0x35,0xd, 0xbe,0x34,0x0, 0x80,0x50,0xd0,0x4d,0x33,0x68,0x26,0x7a,
0x35,0x11,0x7f,0x13,0x7e,0xd, 0x9, 0x12,0xb, 0xef,0x80,0x19,0x74,0x2, 0x12,0xb, 
0x36,0x5e,0x70,0xf4,0x12,0xc, 0x97,0x7e,0x35,0xd, 0x7a,0x35,0x11,0x7f,0x13,0x7e,
0xd, 0x9, 0x12,0x7, 0xd8,0xd3,0xda,0x3b,0x22,0xa9,0xc0,0x93,0x75,0x3e,0x0, 0x32,
0xf, 0x66,0xf0,0x99,0xb9,0x46,0x98,0x67,0xff,0x0, 0xff,0x0, 0xff,0xff,0xff,0xff,
0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,
0x7c,0x6b,0xc2,0x2, 0xe5,0x21,0x14,0x78,0x3, 0x2, 0x3, 0x58,0x1b,0xb1,0x78,0x3, 
0x2, 0x2, 0xb0,0x1b,0xb1,0x78,0x3, 0x2, 0x3, 0x7, 0x14,0x78,0x3, 0x2, 0x3, 0x58,
0x14,0x78,0x3, 0x2, 0x3, 0x18,0x1b,0xb1,0x78,0x3, 0x2, 0x3, 0x3f,0x24,0xf9,0x78,
0x3, 0x2, 0x3, 0x54,0x24,0xaf,0x78,0x3, 0x2, 0x3, 0xc0,0x14,0x78,0x3, 0x2, 0x3, 
0xce,0x1b,0xb1,0x68,0x41,0x14,0x78,0x3, 0x2, 0x3, 0x5b,0x14,0x78,0x3, 0x2, 0x3, 
0x58,0x1b,0xb2,0x78,0x3, 0x2, 0x3, 0x58,0x24,0xda,0x68,0x2d,0x24,0xe6,0x68,0x26,
0x24,0xfa,0x68,0x42,0x1b,0xb1,0x78,0x3, 0x2, 0x2, 0x12,0x14,0x78,0x3, 0x2, 0x2, 
0xb0,0x24,0xf4,0x78,0x3, 0x2, 0x2, 0x12,0x24,0xf3,0x78,0x3, 0x2, 0x3, 0x58,0x24,
0x77,0x68,0x3, 0x2, 0x3, 0xd5,0x2, 0x3, 0xca,0xbe,0x60,0x4, 0x50,0xc, 0x75,0x17,
0x0, 0x7c,0x16,0x2e,0x10,0x24,0x7c,0xb7,0xa5,0xf7,0xa5,0xbe,0x0, 0x2, 0x80,0x3, 
0x2, 0x3, 0xd5,0xd2,0x2, 0x22,0x75,0x37,0x0, 0x7c,0xb6,0x14,0x68,0xa, 0x14,0x68,
0x17,0x14,0x68,0x25,0x24,0x3, 0x78,0x3a,0xa, 0x27,0x6d,0x11,0x6d,0x0, 0x7a,0xd, 
0x30,0x9f,0x0, 0x7a,0xd, 0x3f,0x80,0x27,0xa, 0x57,0x7c,0xab,0xe4,0x6d,0x44,0x7e,
0xd, 0x30,0x2f,0x2, 0x7a,0xd, 0x30,0x80,0x19,0xa, 0x57,0x6d,0x44,0x7e,0xd, 0x30,
0x2f,0x2, 0x7a,0xd, 0x30,0x75,0x37,0x1, 0x7e,0x24,0x0, 0x4, 0x7a,0x25,0x2e,0x75,
0x17,0x0, 0x7c,0xb6,0x24,0x0, 0x78,0x3, 0x2, 0x3, 0xd5,0x1b,0xb1,0x68,0x1e,0x14,
0x68,0x1e,0x14,0x68,0x1e,0x14,0x68,0x1e,0xb, 0xb2,0x78,0x33,0x30,0x1, 0x7, 0x7e,
0x8, 0x0, 0x49,0x2, 0x2, 0xcd,0x7e,0x8, 0x1, 0x55,0x2, 0x2, 0xcd,0x2, 0x3, 0x80,
0x2, 0x3, 0x87,0x2, 0x3, 0x9f,0xa, 0x27,0x7e,0xd, 0x44,0xb, 0x16,0xb, 0xa, 0x30,
0x2d,0x32,0x1b,0xa, 0x30,0x6d,0x33,0x7e,0xd, 0x44,0x79,0x30,0x0, 0x6, 0x22,0x7c,
0xb7,0x62,0x17,0x7e,0x2d,0x44,0x2e,0x54,0x0, 0x6, 0xb, 0x2a,0x20,0x7d,0x12,0xb, 
0x14,0x1b,0x2a,0x10,0x7e,0xd, 0x44,0x2d,0x12,0x39,0x70,0x0, 0x8, 0x7e,0xd, 0x44,
0x69,0x50,0x0, 0x4, 0x69,0x20,0x0, 0x6, 0xbd,0x25,0x50,0x3, 0x2, 0x3, 0xd5,0x75,
0x43,0x0, 0x6d,0x44,0x7e,0x1d,0x3f,0x2f,0x12,0x7a,0x1d,0x3f,0xe5,0x21,0xb4,0xb2,
0x3, 0x75,0x43,0x1, 0xb2,0x1, 0x7a,0xd, 0x38,0x7e,0x34,0x0, 0x2, 0x2, 0x3, 0xd2,
0x7c,0xb6,0x1b,0xb1,0x68,0x1d,0x14,0x68,0x1d,0xb, 0xb1,0x68,0x3, 0x2, 0x3, 0xd5,
0x30,0x1, 0x6, 0x7e,0x8, 0x0, 0x49,0x80,0x4, 0x7e,0x8, 0x1, 0x55,0x7a,0xd, 0x44,
0x2, 0x3, 0x6f,0x2, 0x3, 0x80,0x75,0x3d,0x0, 0xe5,0x21,0xb4,0xb3,0x3, 0x75,0x3d,
0x1, 0xa, 0x57,0x6d,0x44,0x7e,0xd, 0x44,0x69,0x30,0x0, 0x2, 0xb, 0xa, 0x20,0x2f,
0x12,0x79,0x30,0x0, 0x2, 0x1b,0xa, 0x20,0x7e,0x1d,0x44,0x7a,0x1d,0x38,0xd2,0x2, 
0x7e,0x34,0x0, 0x1, 0x2, 0x3, 0xd2,0xbe,0x60,0x1, 0x68,0x9, 0xa5,0xbe,0x2, 0x5, 
0x7a,0x71,0x48,0xd2,0x3, 0xd2,0x2, 0x22,0x75,0xe6,0x0, 0xe4,0x7e,0x34,0x1, 0x4, 
0x7e,0x24,0x0, 0xff,0x7a,0x1b,0xb0,0x7e,0x34,0x1, 0x5, 0x7a,0x1b,0xb0,0x7e,0x34,
0x1, 0x8, 0x7a,0x1b,0xb0,0x7e,0x34,0x1, 0x9, 0x7a,0x1b,0xb0,0xd2,0x4, 0x22,0xa5,
0xbe,0x1, 0x4, 0x7a,0x71,0x3c,0x22,0xa5,0xbe,0x2, 0x2, 0x80,0x3, 0x2, 0x3, 0xd5,
0x7a,0x71,0x22,0x22,0x7a,0x71,0x36,0x22,0xd2,0x2, 0x22,0x1b,0x61,0x68,0x21,0x1b,
0x60,0x68,0x24,0x1b,0x60,0x68,0x38,0x1b,0x60,0x68,0x40,0xb, 0x62,0x78,0x66,0xa, 
0x37,0x7d,0x3, 0x6d,0x11,0x7e,0x1d,0x44,0x79,0x11,0x0, 0x2, 0x1b,0x1a,0x0, 0x22,
0xa, 0x57,0x7c,0xab,0xe4,0x80,0x2, 0xa, 0x57,0x6d,0x44,0x7e,0xd, 0x44,0x69,0x30,
0x0, 0x2, 0xb, 0xa, 0x20,0x2f,0x12,0x79,0x30,0x0, 0x2, 0x1b,0xa, 0x20,0x22,0x7c,
0x67,0x6c,0x77,0x7e,0xd, 0x44,0x79,0x30,0x0, 0x4, 0x22,0xa, 0x27,0x7e,0xd, 0x44,
0xb, 0x16,0xb, 0xa, 0x30,0x2d,0x32,0x1b,0xa, 0x30,0x7e,0x34,0x0, 0x3, 0x80,0x12,
0x7e,0x34,0x0, 0x4, 0x7a,0x35,0x2e,0x75,0x37,0x0, 0x75,0x17,0x0, 0x22,0x7e,0x34,
0x0, 0x5, 0x7a,0x35,0x2e,0x22,0x80,0x18,0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 
0x0, 0x0, 0xe5,0x48,0x70,0xa, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 
0x7d,0x23,0x1b,0x34,0x4d,0x22,0x78,0xe0,0x22,0x2, 0xf, 0x3e,0xff,0xff,0xff,0xff,
0x56,0x30,0x2e,0x37,0x4a,0x75,0x6c,0x20,0x32,0x35,0x20,0x32,0x30,0x31,0x38,0x0, 
0x46,0x54,0x53,0x38,0x36,0x30,0x37,0x5f,0x70,0x72,0x61,0x6d,0x62,0x6f,0x6f,0x74,
0x12,0xe, 0x9a,0x2, 0x6, 0x50,0x7e,0x35,0x2e,0x1b,0x34,0x78,0x3, 0x2, 0x4, 0xce,
0x1b,0x35,0x78,0x3, 0x2, 0x5, 0x19,0x1b,0x34,0x78,0x3, 0x2, 0x5, 0x43,0x1b,0x34,
0x78,0x3, 0x2, 0x6, 0x1c,0x2e,0x34,0x0, 0x3, 0x68,0x3, 0x2, 0x6, 0x3c,0x6d,0x33,
0x7a,0x35,0x2e,0x7a,0x35,0x34,0x30,0x5, 0x5, 0x12,0xe, 0xe3,0xc2,0x5, 0xe5,0x43,
0xb4,0x1, 0x39,0x7e,0xd, 0x38,0x69,0x30,0x0, 0x2, 0xb, 0xa, 0x20,0xb, 0x24,0x2e,
0x18,0xd0,0x0, 0x79,0x30,0x0, 0x2, 0x1b,0xa, 0x20,0x7e,0xd, 0x38,0x69,0x30,0x0, 
0x2, 0xb, 0xa, 0x20,0x2e,0x18,0x0, 0x20,0x79,0x30,0x0, 0x2, 0x1b,0xa, 0x20,0x7e,
0xd, 0x30,0x7e,0x1d,0x3f,0xbf,0x10,0x40,0x3, 0x12,0xb, 0x93,0x7e,0xd, 0x38,0x69,
0x30,0x0, 0x4, 0x7a,0x35,0xd, 0x69,0x30,0x0, 0x2, 0xb, 0xa, 0x20,0x2e,0x14,0x0, 
0x8, 0x12,0x0, 0x46,0xd2,0x5, 0x7e,0x2d,0x38,0x69,0x12,0x0, 0x4, 0x69,0x32,0x0, 
0x2, 0xb, 0x2a,0x20,0x12,0xc, 0x44,0x2e,0x34,0x10,0x0, 0x2, 0x6, 0x17,0x6d,0x33,
0x7a,0x35,0x2e,0xe5,0x3d,0xb4,0x1, 0x17,0x7e,0xd, 0x38,0x69,0x30,0x0, 0x2, 0xb, 
0xa, 0x20,0xb, 0x24,0x2e,0x18,0xd0,0x0, 0x79,0x30,0x0, 0x2, 0x1b,0xa, 0x20,0x7e,
0x34,0x1, 0x0, 0x7a,0x35,0x12,0x7e,0xd, 0x38,0x69,0x30,0x0, 0x2, 0xb, 0xa, 0x20,
0x2e,0x14,0x0, 0x8, 0x12,0xe, 0xf4,0x20,0x0, 0x3, 0x2, 0x6, 0x3c,0x7e,0x1d,0x38,
0x29,0xb1,0x0, 0x8, 0xf5,0x91,0x2, 0x6, 0x3c,0x6d,0x33,0x7a,0x35,0x2e,0x7a,0x35,
0x34,0x7e,0x18,0x0, 0x17,0x7a,0x1d,0xb, 0x7e,0xd, 0x38,0x69,0x30,0x0, 0x2, 0xb, 
0xa, 0x20,0x69,0x10,0x0, 0x4, 0x12,0x7, 0x2c,0x12,0xe, 0xe3,0x7e,0x34,0xf0,0x55,
0x2, 0x6, 0x17,0x6d,0x33,0x7a,0x35,0x2e,0x7a,0x35,0x34,0x12,0xe, 0x7a,0x40,0x6, 
0x7e,0x34,0xf0,0x2d,0x80,0xe, 0xe5,0x37,0xb4,0x1, 0xf, 0x74,0x1d,0x12,0x6, 0x57,
0x7e,0x34,0xf0,0xaa,0x7a,0x35,0x34,0x2, 0x6, 0x39,0xe5,0x3c,0xb4,0xa, 0x21,0xe5,
0x23,0xb4,0x80,0x16,0xe4,0x12,0xd, 0x27,0x7e,0xd0,0x10,0x7c,0xbd,0x12,0x6, 0x57,
0xb, 0xd0,0xbe,0xd0,0x16,0x78,0xf4,0x2, 0x6, 0x10,0x12,0x8, 0x6e,0x2, 0x6, 0x10,
0xe5,0x3c,0xb4,0xb, 0x27,0xe5,0x23,0xb4,0x80,0x11,0x7e,0xe0,0x1, 0x7c,0xbe,0x12,
0x6, 0x57,0xb, 0xe0,0xbe,0xe0,0x16,0x78,0xf4,0x80,0x65,0x7e,0xe0,0x4, 0x7c,0xbe,
0x12,0x6, 0x57,0xb, 0xe0,0xbe,0xe0,0x40,0x78,0xf4,0x80,0x54,0xe5,0x3c,0xb4,0xc, 
0x6, 0xe4,0x12,0x6, 0x57,0x80,0x49,0xe5,0x3c,0xb4,0xd, 0x27,0xe5,0x23,0xb4,0x80,
0x11,0x7e,0xf0,0x11,0x7c,0xbf,0x12,0x6, 0x57,0xb, 0xf0,0xbe,0xf0,0x16,0x78,0xf4,
0x80,0x2e,0x7e,0xf0,0x4, 0x7c,0xbf,0x12,0x6, 0x57,0xb, 0xf0,0xbe,0xf0,0x40,0x78,
0xf4,0x80,0x1d,0xe5,0x3c,0xa, 0x5b,0x9e,0x54,0x0, 0x80,0xf5,0x8, 0x6c,0xcc,0x80,
0x9, 0xe5,0x8, 0x12,0x6, 0x57,0x5, 0x8, 0xb, 0xc0,0xe5,0x22,0xbc,0xbc,0x38,0xf1,
0x12,0xe, 0xe3,0x7e,0x34,0xf0,0xaa,0x7a,0x35,0x34,0x80,0x20,0x6d,0x33,0x7a,0x35,
0x2e,0x7a,0x35,0x34,0x12,0xe, 0x7a,0x50,0x9, 0x7e,0x34,0xf0,0xaa,0x7a,0x35,0x34,
0x80,0x7, 0x7e,0x34,0xf0,0x2d,0x7a,0x35,0x34,0x12,0xe, 0xe3,0x30,0x4, 0x11,0x7e,
0x34,0x13,0x88,0x12,0x3, 0xd6,0x7e,0x34,0x13,0x88,0x12,0x3, 0xd6,0x75,0xe9,0xff,
0x30,0x6, 0x3, 0x2, 0x4, 0x26,0x22,0xca,0xf8,0x7c,0xfb,0xe5,0x23,0xb4,0x80,0x4a,
0xd2,0x7, 0x12,0xe, 0xd0,0x74,0x20,0xca,0xb8,0xa, 0x3f,0x6d,0x22,0x74,0xc, 0x2f,
0x11,0x14,0x78,0xfb,0xda,0xb8,0x12,0xd, 0xd4,0xa9,0xd2,0xb4,0x12,0xf, 0x34,0x12,
0x0, 0x2e,0x50,0x9, 0x7e,0x35,0x18,0xbe,0x34,0x1, 0xf4,0x28,0xf2,0x7e,0x35,0x18,
0xbe,0x34,0x1, 0xf4,0x38,0x6, 0x12,0x3, 0xf9,0x2, 0x7, 0x29,0xc2,0x86,0x7e,0x34,
0x13,0x88,0x12,0x3, 0xd6,0xd2,0x86,0x2, 0x7, 0x29,0x74,0x1, 0x12,0xa, 0x6b,0x74,
0x1, 0x6d,0x33,0x12,0xc, 0x97,0xe4,0x12,0xb, 0x36,0x5e,0x34,0x80,0x0, 0x7c,0x4f,
0x6c,0x55,0x3e,0x24,0x4d,0x32,0x12,0xc, 0x97,0x74,0x4, 0x6d,0x33,0x12,0xc, 0x97,
0x7e,0x34,0x0, 0x50,0x12,0xc, 0x97,0x7e,0x34,0x0, 0x19,0x12,0x3, 0xd6,0x74,0x4, 
0x7e,0x34,0x0, 0x51,0x12,0xc, 0x97,0x7e,0x34,0xa2,0x1c,0x12,0x3, 0xd6,0x74,0x4, 
0x7e,0x34,0x0, 0x11,0x12,0xc, 0x97,0x7e,0x34,0x0, 0x19,0x12,0x3, 0xd6,0x74,0x4, 
0x7e,0x34,0x0, 0x10,0x12,0xc, 0x97,0x7e,0x34,0x0, 0x19,0x12,0x3, 0xd6,0x74,0x4, 
0x6d,0x33,0x12,0xc, 0x97,0x7e,0x34,0x0, 0x5, 0x12,0x3, 0xd6,0xe4,0x12,0xa, 0x6b,
0x74,0x4, 0x7e,0x34,0xff,0xf7,0x12,0xc, 0x97,0xda,0xf8,0x22,0xca,0x3b,0x7a,0x15,
0x9, 0x7f,0x31,0x75,0xf, 0x0, 0x7e,0x35,0x9, 0xbe,0x34,0x0, 0x0, 0x38,0x4f,0x7e,
0x34,0xff,0xff,0x7a,0x35,0x9, 0x75,0xf, 0x1, 0x80,0x43,0x7e,0x34,0x0, 0x80,0x7a,
0x35,0x12,0x7f,0x13,0x7e,0x8, 0x2, 0x61,0x12,0xe, 0xf4,0x7e,0x35,0x9, 0x9e,0x34,
0x0, 0x80,0x7a,0x35,0x9, 0x2e,0x38,0x0, 0x80,0x6d,0x33,0x7a,0x35,0x10,0x7e,0x35,
0x10,0x9, 0x63,0x2, 0x61,0x7e,0xd, 0xb, 0x7e,0xb, 0x70,0x6c,0x76,0x7a,0xb, 0x70,
0x7e,0x35,0x10,0xb, 0x34,0x7a,0x35,0x10,0xbe,0x34,0x0, 0x80,0x78,0xe0,0x7e,0x35,
0x9, 0xbe,0x34,0x0, 0x80,0x38,0xb4,0xe5,0xf, 0x60,0x5, 0xb, 0x34,0x7a,0x35,0x9, 
0x7e,0x35,0x9, 0x7a,0x35,0x12,0x7f,0x13,0x7e,0x8, 0x2, 0x61,0x12,0xe, 0xf4,0x6d,
0x33,0x80,0x17,0x7e,0x35,0x10,0x9, 0x63,0x2, 0x61,0x7e,0xd, 0xb, 0x7e,0xb, 0x70,
0x6c,0x76,0x7a,0xb, 0x70,0x7e,0x35,0x10,0xb, 0x34,0x7a,0x35,0x10,0x7e,0x35,0x9, 
0xbe,0x35,0x10,0x38,0xde,0xda,0x3b,0x22,0xca,0x3b,0x7f,0x30,0x7c,0xb6,0xf5,0x13,
0x7c,0xb7,0xf5,0x14,0x74,0x1, 0x7e,0x35,0x11,0x1e,0x34,0x1b,0x34,0x4e,0x60,0x80,
0x12,0xc, 0x97,0x12,0xa, 0x6b,0xa9,0xc2,0xb4,0xa9,0xc6,0xb3,0x75,0xb5,0x2, 0xa9,
0x36,0xb3,0xfc,0xa9,0xc6,0xb3,0x75,0xb5,0x0, 0xa9,0x36,0xb3,0xfc,0xa9,0xc6,0xb3,
0x85,0x13,0xb5,0xa9,0x36,0xb3,0xfc,0xa9,0xc6,0xb3,0x85,0x14,0xb5,0xa9,0x36,0xb3,
0xfc,0xa9,0xc6,0xb3,0x6d,0x33,0x80,0x2a,0x7f,0x13,0x2e,0x35,0x15,0x7e,0x1b,0xb0,
0xf5,0xb5,0xa9,0x36,0xb3,0xfc,0xa9,0xc6,0xb3,0x7e,0x35,0x15,0x5e,0x34,0x0, 0x1, 
0xbe,0x34,0x0, 0x1, 0x78,0x7, 0x7e,0x34,0x0, 0x78,0x12,0x3, 0xd6,0x7e,0x35,0x15,
0xb, 0x34,0x7a,0x35,0x15,0x7e,0x35,0x11,0xbe,0x35,0x15,0x38,0xcb,0xa9,0xd2,0xb4,
0x7e,0x34,0x0, 0x5, 0x12,0x3, 0xd6,0xe4,0x12,0xa, 0x6b,0xda,0x3b,0x22,0xe5,0x23,
0xb4,0x80,0x16,0xd2,0x7, 0x12,0xe, 0xd0,0xa9,0xc2,0xb4,0x74,0x60,0x12,0xf, 0x29,
0xa9,0xd2,0xb4,0x12,0x0, 0x2e,0x40,0xfb,0x22,0x74,0x1, 0x12,0xa, 0x6b,0xe4,0x6d,
0x33,0x12,0xc, 0x97,0x74,0x1, 0x6d,0x33,0x12,0xc, 0x97,0x74,0x4, 0x6d,0x33,0x12,
0xc, 0x97,0x7e,0x34,0x0, 0x54,0x12,0xc, 0x97,0x7e,0x34,0x0, 0x19,0x12,0x3, 0xd6,
0x74,0x4, 0x7e,0x34,0x0, 0x55,0x12,0xc, 0x97,0x7e,0x34,0xa2,0x1c,0x12,0x3, 0xd6,
0x74,0x4, 0x7e,0x34,0x0, 0x15,0x12,0xc, 0x97,0x7e,0x34,0x0, 0xa0,0x12,0x3, 0xd6,
0x74,0x4, 0x7e,0x34,0x0, 0x14,0x12,0xc, 0x97,0x7e,0x34,0x0, 0x19,0x12,0x3, 0xd6,
0x74,0x4, 0x7e,0x34,0x0, 0x4, 0x12,0xc, 0x97,0x7e,0x34,0x0, 0x5, 0x12,0x3, 0xd6,
0xe4,0x12,0xa, 0x6b,0x74,0x4, 0x7e,0x34,0xff,0xf7,0x2, 0xc, 0x97,0x7c,0x7b,0x7e,
0xa0,0xef,0xe5,0x21,0x24,0xfd,0x68,0x3f,0x1b,0xb1,0x68,0x29,0x14,0x68,0x62,0x24,
0xa0,0x68,0x41,0x1b,0xb2,0x68,0x42,0x24,0xb7,0x68,0x2c,0x24,0xe7,0x68,0x35,0x24,
0x3c,0x78,0x57,0xa5,0xbf,0x0, 0x5, 0x7e,0xa0,0x86,0x80,0x4e,0xa5,0xbf,0x1, 0x4a,
0x7e,0xa0,0xa7,0x80,0x45,0xa5,0xbf,0x0, 0x5, 0x7e,0xa1,0x23,0x80,0x3c,0xa5,0xbf,
0x1, 0x38,0x7e,0xa1,0x48,0x80,0x33,0xa, 0x17,0x7e,0x1d,0x44,0x2d,0x31,0x29,0xa1,
0x0, 0x8, 0x80,0x26,0x7e,0xa1,0x17,0x80,0x21,0xa5,0xbf,0x0, 0x9, 0x7e,0x35,0x34,
0xa, 0x56,0x7c,0xab,0x80,0x14,0xa5,0xbf,0x1, 0x10,0x7e,0x55,0x34,0x7c,0xab,0x80,
0x9, 0xa5,0xbf,0x0, 0x5, 0x7e,0xb3,0x3, 0x11,0x22,0x7c,0xba,0x22,0x75,0x84,0x1, 
0x7e,0x44,0x1f,0xff,0xe4,0x7a,0x49,0xb0,0x1b,0x44,0x78,0xf9,0x7e,0xf8,0x3, 0x11,
0xd2,0x5, 0xc2,0x6, 0x75,0x17,0x0, 0x75,0x18,0x0, 0x75,0x19,0x0, 0xd2,0x0, 0xc2,
0x2, 0xc2,0x3, 0xc2,0x4, 0x75,0x21,0x0, 0x75,0x22,0x0, 0x75,0x23,0x80,0x75,0x2e,
0x0, 0x75,0x2f,0x0, 0x75,0x34,0x0, 0x75,0x35,0x0, 0x75,0x36,0x0, 0x75,0x37,0x0, 
0x75,0x3c,0xb, 0x75,0x3d,0x0, 0x75,0x3e,0x0, 0x75,0x43,0x0, 0x75,0x48,0x1, 0x7e,
0x4, 0x0, 0xff,0x7e,0x14,0xf, 0x4f,0xb, 0xa, 0x40,0x5d,0x44,0x68,0x1a,0x69,0x20,
0x0, 0x2, 0xb, 0xe, 0xb, 0x44,0x80,0xa, 0x7e,0xb, 0xb0,0x7a,0x29,0xb0,0xb, 0x24,
0xb, 0xc, 0x1b,0x44,0x78,0xf2,0x80,0xdf,0x2, 0x4, 0x20,0xca,0xf8,0xc2,0x7, 0x7e,
0xf0,0x70,0x75,0x91,0x0, 0xc2,0x90,0xc2,0x91,0x20,0x7, 0x10,0x7e,0xf1,0xe4,0xbe,
0xf0,0x2, 0x40,0x5, 0xbe,0xf0,0xfd,0x28,0x3, 0x7e,0xf0,0x70,0x30,0x6, 0x38,0x7e,
0x34,0x0, 0x2, 0x7a,0x35,0x12,0x7e,0x18,0x7, 0x80,0x7e,0x8, 0x0, 0x9, 0x12,0xe, 
0xf4,0xe5,0x9, 0xbe,0xb0,0xff,0x68,0x19,0xe5,0x9, 0x60,0x15,0xe5,0xa, 0xa, 0x2b,
0xe5,0x9, 0xa, 0x3b,0x2d,0x32,0xbe,0x34,0x0, 0xff,0x78,0x5, 0x7e,0xf1,0x9, 0xd2,
0x7, 0x20,0x7, 0x3, 0x7e,0xf0,0x70,0x5e,0xf0,0xfe,0x7a,0xf1,0x92,0xd2,0xe8,0xc2,
0xc0,0xa9,0xd5,0xb7,0xd2,0xbd,0xd2,0xad,0xda,0xf8,0x22,0xca,0x79,0xbe,0xb0,0x0, 
0x28,0x2e,0x74,0x6, 0x12,0xb, 0x36,0x7d,0x73,0x6c,0xff,0x7e,0xf0,0xa5,0x7d,0x37,
0x12,0xc, 0x97,0x6c,0xff,0x7e,0xf0,0xf, 0x7d,0x37,0x12,0xc, 0x97,0x6c,0xff,0x7e,
0xf0,0x6a,0x7d,0x37,0x12,0xc, 0x97,0x7e,0x34,0x0, 0x5, 0x12,0x3, 0xd6,0x80,0x30,
0x74,0x1, 0x7e,0x34,0xdf,0xff,0x12,0xc, 0x97,0x74,0x6, 0x12,0xb, 0x36,0x7d,0x73,
0x6c,0xff,0x7d,0x37,0x12,0xc, 0x97,0x7d,0x37,0x12,0xc, 0x97,0x7d,0x37,0x12,0xc, 
0x97,0x74,0x2, 0x12,0xb, 0x36,0x7d,0x73,0x4e,0xf0,0x1, 0x7d,0x37,0x12,0xc, 0x97,
0xda,0x79,0x22,0xca,0x3b,0x7e,0x74,0xf0,0x0, 0x7e,0x64,0x0, 0x1, 0x6c,0xaa,0xa, 
0x3a,0x19,0xa3,0x3, 0x1, 0xb, 0xa0,0xbe,0xa0,0x10,0x78,0xf3,0x7e,0x34,0x0, 0x10,
0x7a,0x35,0xd, 0x7f,0x13,0x7e,0x8, 0x3, 0x1, 0x12,0x0, 0x46,0x6c,0xaa,0xe4,0xa, 
0x4a,0x19,0xb4,0x3, 0x1, 0xb, 0xa0,0xbe,0xa0,0x10,0x78,0xf3,0x7e,0x34,0x0, 0x10,
0x7a,0x35,0x12,0x7f,0x13,0x7e,0x8, 0x3, 0x1, 0x12,0xe, 0xf4,0x6c,0xaa,0xa, 0x3a,
0x9, 0xb3,0x3, 0x1, 0xbc,0xba,0x68,0x3, 0xc3,0x80,0x8, 0xb, 0xa0,0xbe,0xa0,0x10,
0x40,0xec,0xd3,0xda,0x3b,0x22,0xa9,0xc2,0xb4,0xa9,0xc6,0xb3,0x75,0xb5,0x5, 0xa9,
0x36,0xb3,0xfc,0xa9,0xc6,0xb3,0x75,0xb5,0x0, 0xa9,0x36,0xb3,0xfc,0xa9,0xc6,0xb3,
0x75,0xb5,0x0, 0xa9,0x36,0xb3,0xfc,0xa9,0xc6,0xb3,0xf5,0xb5,0xa9,0x36,0xb3,0xfc,
0xa9,0xc6,0xb3,0x75,0xb5,0x0, 0xa9,0x36,0xb3,0xfc,0xa9,0xc6,0xb3,0x75,0xb5,0x0, 
0xa9,0x36,0xb3,0xfc,0xa9,0xc6,0xb3,0x7e,0x71,0xb5,0x75,0xb5,0x0, 0xa9,0x36,0xb3,
0xfc,0xa9,0xc6,0xb3,0x7e,0xa1,0xb5,0xa9,0xd2,0xb4,0x7c,0x47,0x6c,0x55,0xa, 0x3a,
0x4d,0x32,0x22,0x7e,0x34,0xd0,0x0, 0x7e,0x24,0x0, 0x1, 0x74,0xff,0x6c,0xaa,0xa, 
0x4a,0x19,0xb4,0x2, 0xe1,0xb, 0xa0,0xbe,0xa0,0x20,0x40,0xf3,0x7e,0xd, 0x30,0x7c,
0xb2,0x7a,0xb3,0x2, 0xe1,0x7c,0xb3,0x7a,0xb3,0x2, 0xe2,0x7d,0x1, 0x7e,0x14,0xff,
0xff,0x9d,0x10,0xa, 0x2, 0x7a,0x13,0x2, 0xe3,0x7a,0x33,0x2, 0xe4,0xe5,0x17,0x7a,
0xb3,0x2, 0xe5,0xe5,0x17,0xa, 0xb, 0x7e,0x14,0x0, 0xff,0x9d,0x10,0x7a,0x33,0x2, 
0xe6,0x7e,0x14,0x0, 0x20,0x7a,0x15,0xd, 0x7e,0x8, 0x2, 0xe1,0x2, 0x0, 0x46,0x7f,
0x70,0xd2,0x7, 0x12,0xe, 0xd0,0x74,0x2, 0x12,0xd, 0xd4,0x6d,0x33,0x80,0x12,0x7f,
0x7, 0x2d,0x13,0x7e,0xb, 0xb0,0xf5,0xb5,0xa9,0x36,0xb3,0xfc,0xa9,0xc6,0xb3,0xb, 
0x34,0x7e,0x25,0x11,0xbd,0x23,0x38,0xe7,0xa9,0xd2,0xb4,0x12,0xf, 0x34,0x12,0x0, 
0x2e,0x50,0x9, 0x7e,0x35,0x18,0xbe,0x34,0x1, 0xf4,0x28,0xf2,0x7e,0x35,0x18,0xbe,
0x34,0x1, 0xf4,0x38,0x3, 0x2, 0x3, 0xf9,0xc2,0x86,0x7e,0x34,0x13,0x88,0x12,0x3, 
0xd6,0xd2,0x86,0x22,0x6d,0x0, 0x74,0x10,0x4d,0x0, 0x78,0xb, 0x4d,0x22,0x78,0x27,
0x8d,0x31,0x7d,0x12,0x6d,0x22,0x22,0x7d,0x43,0x7d,0x32,0x6d,0x22,0x2f,0x11,0x2d,
0x44,0x50,0x2, 0xa5,0xf, 0xbf,0x10,0x40,0x4, 0x9f,0x10,0xb, 0x90,0x14,0x78,0xed,
0x7f,0x1, 0x6d,0x22,0x7d,0x34,0x22,0x7d,0x41,0x7d,0x13,0x8d,0x24,0x7d,0x2, 0x2f,
0x0, 0x40,0x4, 0xbd,0x4, 0x40,0x4, 0x9d,0x4, 0xb, 0x14,0x14,0x78,0xf1,0x7d,0x23,
0x7d,0x31,0x7d,0x10,0x6d,0x0, 0x22,0x7d,0x23,0xa, 0x36,0x7c,0xa5,0xa9,0xc2,0xb4,
0xa9,0xc6,0xb3,0x75,0xb5,0x1, 0xa9,0x36,0xb3,0xfc,0xa9,0xc6,0xb3,0x75,0xb5,0x0, 
0xa9,0x36,0xb3,0xfc,0xa9,0xc6,0xb3,0x75,0xb5,0x0, 0xa9,0x36,0xb3,0xfc,0xa9,0xc6,
0xb3,0xf5,0xb5,0xa9,0x36,0xb3,0xfc,0xa9,0xc6,0xb3,0x7a,0x71,0xb5,0xa9,0x36,0xb3,
0xfc,0xa9,0xc6,0xb3,0x7a,0xa1,0xb5,0xa9,0x36,0xb3,0xfc,0xa9,0xc6,0xb3,0xa9,0xd2,
0xb4,0x22,0xd2,0x7, 0x12,0xe, 0xd0,0xa9,0xc2,0xb4,0x74,0x5, 0x12,0xf, 0x29,0x12,
0xf, 0x10,0x7c,0xab,0xa9,0xd2,0xb4,0xd2,0x7, 0x12,0xe, 0xd0,0x5e,0xa0,0xc3,0xa9,
0xc2,0xb4,0x74,0x1, 0x12,0xf, 0x29,0x7c,0xba,0x12,0xf, 0x29,0xa9,0xd2,0xb4,0x12,
0x0, 0x2e,0x40,0xfb,0xa9,0xc2,0xb4,0x74,0x5, 0x12,0xf, 0x29,0x12,0xf, 0x10,0x7a,
0xb3,0x3, 0x11,0xa9,0xd2,0xb4,0x22,0x7c,0xab,0xd2,0x7, 0x12,0xe, 0xd0,0x74,0xd8,
0xa, 0x3a,0x7d,0x23,0x6d,0x33,0x12,0xd, 0xd4,0xa9,0xd2,0xb4,0x12,0xf, 0x34,0x12,
0x0, 0x2e,0x50,0x9, 0x7e,0x35,0x18,0xbe,0x34,0x5, 0xdc,0x28,0xf2,0x7e,0x35,0x18,
0xbe,0x34,0x5, 0xdc,0x38,0x3, 0x2, 0x3, 0xf9,0xc2,0x86,0x7e,0x34,0x13,0x88,0x12,
0x3, 0xd6,0xd2,0x86,0x22,0xca,0x2b,0xca,0x1b,0xca,0xb, 0xd2,0x0, 0x30,0x90,0x1c,
0xc2,0x90,0x7e,0x71,0x91,0xe5,0x3e,0x70,0x3, 0x7a,0x71,0x21,0xe5,0x3e,0x12,0x1, 
0x20,0x5, 0x3e,0x30,0x2, 0x6, 0xe4,0x12,0x8, 0xfd,0xf5,0x91,0x30,0x91,0xb, 0xc2,
0x91,0x5, 0x3e,0xe5,0x3e,0x12,0x8, 0xfd,0xf5,0x91,0xda,0xb, 0xda,0x1b,0xda,0x2b,
0x32,0x74,0x1f,0x12,0x6, 0x57,0x7e,0x34,0x0, 0x10,0x7a,0x35,0x12,0x7e,0x34,0xf0,
0x0, 0x7e,0x24,0x0, 0x1, 0x7e,0x8, 0x3, 0x1, 0x12,0xe, 0xf4,0x6c,0xaa,0xa, 0x3a,
0x9, 0xb3,0x3, 0x1, 0xbe,0xb0,0xff,0x68,0x2, 0xc3,0x22,0xb, 0xa0,0xbe,0xa0,0x10,
0x40,0xec,0xd3,0x22,0x7c,0xab,0x7d,0x12,0x7c,0xb3,0xf5,0x15,0x7c,0x36,0x7c,0x25,
0xa, 0x4, 0x7c,0xb3,0xf5,0x14,0x7c,0xb7,0xf5,0x13,0xa9,0xc2,0xb4,0x7c,0xba,0x12,
0xf, 0x29,0xe5,0x15,0x12,0xf, 0x29,0xe5,0x14,0x12,0xf, 0x29,0xe5,0x13,0x2, 0xf, 
0x29,0xca,0xf8,0x7c,0xfb,0xe5,0x23,0xb4,0x81,0x21,0x74,0x2, 0x12,0xb, 0x36,0x4c,
0xff,0x78,0x8, 0xa9,0xc0,0xca,0x5e,0x70,0xdf,0x80,0x6, 0xa9,0xd0,0xca,0x4e,0x70,
0x20,0x74,0x2, 0x12,0xc, 0x97,0x74,0x2, 0x12,0xb, 0x36,0xda,0xf8,0x22,0x7d,0x52,
0xf5,0x16,0x7c,0xb6,0x7c,0xa5,0xa, 0x44,0xf5,0x15,0x7f,0x21,0xf5,0x14,0xa9,0xc2,
0xb4,0x74,0xb, 0x12,0xf, 0x29,0xe5,0x16,0x12,0xf, 0x29,0xe5,0x15,0x12,0xf, 0x29,
0xe5,0x14,0x12,0xf, 0x29,0xe4,0x2, 0xf, 0x29,0xd2,0xcf,0x85,0x48,0xcc,0x75,0xec,
0xff,0x75,0xee,0xff,0x75,0xeb,0x3, 0x75,0xac,0x40,0xa9,0xc5,0xca,0x75,0xed,0xf, 
0x75,0xad,0xb0,0xa9,0xd7,0x94,0xa9,0xd4,0x94,0x22,0xe5,0x23,0xbe,0xb0,0x80,0x68,
0x2, 0xd3,0x22,0x12,0xd, 0xa1,0x40,0x2, 0xc3,0x22,0x12,0xa, 0xd3,0x40,0x2, 0xc3,
0x22,0x12,0xd, 0xa1,0x40,0x2, 0xc3,0x22,0xd3,0x22,0x12,0xe, 0x59,0xa9,0xa6,0x94,
0xb3,0x92,0x6, 0x30,0x6, 0x6, 0x12,0xf, 0x1d,0x12,0xe, 0xba,0x12,0x9, 0xfb,0x12,
0xf, 0x2, 0xd2,0xaf,0x30,0x3, 0xfd,0x2, 0xf, 0x47,0xd2,0x7, 0x12,0xe, 0xd0,0xa9,
0xc2,0xb4,0x74,0x9f,0x12,0xf, 0x29,0x12,0xf, 0x10,0xa9,0xd2,0xb4,0x2, 0xc, 0xe2,
0xa9,0xc2,0xb4,0x30,0x7, 0x4, 0x74,0x6, 0x80,0x2, 0x74,0x4, 0x12,0xf, 0x29,0xa9,
0xd2,0xb4,0x22,0xe5,0x36,0xb4,0xc, 0xb, 0xc2,0x86,0x7e,0x34,0x0, 0x64,0x12,0x3, 
0xd6,0xd2,0x86,0x22,0x12,0xe, 0x2e,0x7e,0x35,0x12,0x12,0x0, 0xe, 0xa9,0xd2,0xb4,
0xd3,0x22,0xc2,0x8c,0x43,0x89,0x2, 0x75,0x8c,0x1, 0x75,0x8a,0x0, 0xd2,0xa9,0x22,
0x75,0xb5,0x0, 0xa9,0x36,0xb3,0xfc,0xa9,0xc6,0xb3,0xe5,0xb5,0x22,0xd2,0xc8,0x75,
0xb3,0x13,0xa9,0xd1,0xb4,0xa9,0xc0,0xb4,0x22,0xf5,0xb5,0xa9,0x36,0xb3,0xfc,0xa9,
0xc6,0xb3,0xd3,0x22,0xc2,0x8c,0x6d,0x33,0x7a,0x35,0x18,0xd2,0x8c,0x22,0x7e,0x35,
0x18,0xb, 0x34,0x7a,0x35,0x18,0x22,0x85,0x48,0xcc,0xe5,0x48,0x2, 0xe, 0x1, 0x0, 
0x1, 0x3, 0x11,0x0, 0x0, 0x4, 0x0, 0x30,0x0, 0x0, 0x0, 0x0, 0x0, 0x4, 0x0, 0x3f,
0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 
};

/*****************************************************************************
* Private constant and macro definitions using #define
*****************************************************************************/
#define MAX_BANK_DATA               0x80
#define MAX_GAMMA_LEN               0x180
#define LIC_BANK_LEN_OFF            0
#define LIC_BANK_HEAD_LEN           0
#define LIC_BANK_START_ADDR         0x02
/* calculate lcd init code checksum */
static unsigned short cal_lcdinitcode_checksum(u8 *ptr, int initcode_length)
{
    u32 checksum = 0;
    u8 *p_block_addr;
    u16 block_len;
    u16 param_num;
    int i;
    int index = 2;

    while (index < initcode_length - 6) {
        p_block_addr = ptr + index;
        block_len = ((p_block_addr[0] << 8) + p_block_addr[1]) * 2;
        param_num = block_len - 4;

        checksum += ( param_num * ( param_num - 1 ) / 2 );

        checksum += p_block_addr[3];

        for ( i = 0; i < param_num; ++i ) {
            checksum += p_block_addr[4 + i];
        }

        checksum &= 0xffff;

        index += block_len;
    }

    return checksum;
}

static int print_data(u8 *buf, u32 len)
{
    int i = 0;
    int n = 0;
    u8 *p = NULL;

    p = kzalloc(len * 4, GFP_KERNEL);
    for (i = 0; i < len; i++) {
        n += snprintf(p + n, PAGE_SIZE, "%02x ", buf[i]);
    }

    FTS_DEBUG("%s", p);

    kfree(p);
    return 0;
}

static int find_bank(
    u8 *initcode,
    u16 bank_start_addr,
    u8 *bank_sign,
    u16 *bank_pos)
{
    u16 pos = bank_start_addr;
    u16 initcode_len = 0;

    initcode_len = ((u16)(((u16)initcode[0]) << 8) + initcode[1]) * 2;
    if ((initcode_len >= FTS_MAX_LEN_SECTOR) || (initcode_len <= FTS_MIN_LEN)) {
        FTS_ERROR("host lcd init code len(%x) is too large", initcode_len);
        return -EINVAL;
    }
    FTS_INFO("lic saddr:%x, len:%d", pos, initcode_len);

    while (pos < initcode_len) {
        if ((initcode[pos] == bank_sign[0])
            && (initcode[pos + 1] == bank_sign[1])
            && (initcode[pos + 2] == bank_sign[2])
            && (initcode[pos + 3] == bank_sign[3])) {
            FTS_INFO("bank(%x %x %x %x) find",
                     bank_sign[0], bank_sign[1], bank_sign[2], bank_sign[3]);
            *bank_pos = pos;
            return 0;
        } else {
            pos += (((u16)initcode[pos + LIC_BANK_LEN_OFF] << 8)
                    + initcode[pos + LIC_BANK_LEN_OFF + 1]) * 2 + LIC_BANK_HEAD_LEN;
        }
    }

    return -ENODATA;
}

static int read_3gamma(u8 **gamma, u16 *len)
{
    int ret = 0;
    int i = 0;
    int packet_num = 0;
    int packet_len = 0;
    int remainder = 0;
    u8 cmd[4] = { 0 };
    u32 addr = 0x01D000;
    u8 gamma_header[0x20] = { 0 };
    u16 gamma_len = 0;
    u16 gamma_len_n = 0;
    u8 *pgamma = NULL;
    int j = 0;
    u8 gamma_ecc = 0;

    cmd[0] = 0x05;
    cmd[1] = 0x80;
    cmd[2] = 0x01;
    ret = fts_write(cmd, 3);
    if (ret < 0) {
        FTS_ERROR("get flash type and clock fail !");
        return ret;
    }

    cmd[0] = 0x03;
    cmd[1] = (u8)(addr >> 16);
    cmd[2] = (u8)(addr >> 8);
    cmd[3] = (u8)addr;
    ret = fts_write(cmd, 4);
    msleep(10);

    ret = fts_read(NULL, 0, gamma_header, 0x20);
    if (ret < 0) {
        FTS_ERROR("read 3-gamma header fail");
        return ret;
    }

    gamma_len = (u16)((u16)gamma_header[0] << 8) + gamma_header[1];
    gamma_len_n = (u16)((u16)gamma_header[2] << 8) + gamma_header[3];

    if ((gamma_len + gamma_len_n) != 0xFFFF) {
        FTS_INFO("gamma length check fail:%x %x", gamma_len, gamma_len);
        return -EIO;
    }

    if ((gamma_header[4] + gamma_header[5]) != 0xFF) {
        FTS_INFO("gamma ecc check fail:%x %x", gamma_header[4], gamma_header[5]);
        return -EIO;
    }

    if (gamma_len > MAX_GAMMA_LEN) {
        FTS_ERROR("gamma data len(%d) is too long", gamma_len);
        return -EINVAL;
    }

    *gamma = kzalloc(MAX_GAMMA_LEN, GFP_KERNEL);
    if (NULL == *gamma) {
        FTS_ERROR("malloc gamma memory fail");
        return -ENOMEM;
    }
    pgamma = *gamma;

    packet_num = gamma_len / 256;
    packet_len = 256;
    remainder = gamma_len % 256;
    if (remainder) packet_num++;
    FTS_INFO("3-gamma len:%d", gamma_len);
    cmd[0] = 0x03;
    addr += 0x20;
    for (i = 0; i < packet_num; i++) {
        addr += i * 256;
        cmd[1] = (u8)(addr >> 16);
        cmd[2] = (u8)(addr >> 8);
        cmd[3] = (u8)addr;
        if ((i == packet_num - 1) && remainder)
            packet_len = remainder;
        ret = fts_write(cmd, 4);
        msleep(10);

        ret = fts_read(NULL, 0, pgamma + i * 256, packet_len);
        if (ret < 0) {
            FTS_ERROR("read 3-gamma data fail");
            return ret;
        }
    }


    /*  ecc */
    for (j = 0; j < gamma_len; j++) {
        gamma_ecc ^= pgamma[j];
    }
    FTS_INFO("back_3gamma_ecc: 0x%x, 0x%x", gamma_ecc, gamma_header[0x04]);
    if (gamma_ecc != gamma_header[0x04]) {
        FTS_ERROR("back gamma ecc check fail:%x %x", gamma_ecc, gamma_header[0x04]);
        return -EIO;
    }

    *len = gamma_len;

    FTS_DEBUG("read 3-gamma data:");
    print_data(*gamma, gamma_len);

    return 0;
}

static int replace_3gamma(u8 *initcode, u8 *gamma, u16 gamma_len)
{
    int ret = 0;
    u16 gamma_pos = 0;
    int i = 0;
    u8 gamma_bank[4] = {0x00, 0x20, 0x82, 0xD1};
    u16 bank_addr = 0;
    u16 bank_saddr = LIC_BANK_START_ADDR;
    u16 bank_len = 0;

    FTS_FUNC_ENTER();
    /* bank Gamma */
    for (i = 0; i < 6; i++) {
        ret = find_bank(initcode, bank_saddr, gamma_bank, &bank_addr);
        if (ret < 0) {
            FTS_ERROR("find gamma bank fail");
            goto find_gamma_bank_err;
        }
        bank_len = (((u16)initcode[bank_addr + LIC_BANK_LEN_OFF] << 8 )
                    + initcode[bank_addr + LIC_BANK_LEN_OFF + 1]) * 2 + LIC_BANK_HEAD_LEN;
        memcpy(initcode + bank_addr, gamma + gamma_pos, bank_len);

        bank_saddr = bank_addr;
        gamma_pos += bank_len;
        gamma_bank[3] += 0x01;
    }

    FTS_DEBUG("replace 3-gamma data:");
    print_data(initcode + 0x468, gamma_len);

    FTS_FUNC_EXIT();
    return 0;

find_gamma_bank_err:
    FTS_INFO("3-gamma bank(%02x %02x %02x %02x) not find", gamma[gamma_pos],
             gamma[gamma_pos + 1], gamma[gamma_pos + 2], gamma[gamma_pos + 3]);
    return -ENODATA;
}

static int read_replace_3gamma(u8 *buf)
{
    int ret = 0;
    u16 initcode_checksum = 0;
    u8 *gamma = NULL;
    u16 gamma_len = 0;
    u16 hlic_len = 0;

    FTS_FUNC_ENTER();

    ret = read_3gamma(&gamma, &gamma_len);
    if (ret < 0) {
        FTS_INFO("no vaid 3-gamma data, not replace");
        if (gamma)
            kfree(gamma);
        return 0;
    }

    ret = replace_3gamma(buf, gamma, gamma_len);
    if (ret < 0) {
        FTS_ERROR("replace 3-gamma fail");
        kfree(gamma);
        return ret;
    }

    hlic_len = ((u16)(((u16)buf[0]) << 8) + buf[1]) * 2;
    if ((hlic_len >= FTS_MAX_LEN_SECTOR) || (hlic_len <= FTS_MIN_LEN)) {
        FTS_ERROR("host lcd init code len(%x) is too large", hlic_len);
        return -EINVAL;
    }
    initcode_checksum = cal_lcdinitcode_checksum(buf, hlic_len);
    FTS_INFO("lcd init code calc checksum:0x%04x", initcode_checksum);
    buf[hlic_len - 2] = (u8)(initcode_checksum >> 8);
    buf[hlic_len - 1] = (u8)(initcode_checksum);

    FTS_FUNC_EXIT();

    kfree(gamma);
    return 0;
}

static int check_initial_code_valid(u8 *buf)
{
    u16 initcode_checksum = 0;
    u16 buf_checksum = 0;
    u16 hlic_len = 0;

    hlic_len = ((u16)(((u16)buf[0]) << 8) + buf[1]) * 2;
    if ((hlic_len >= FTS_MAX_LEN_SECTOR) || (hlic_len <= FTS_MIN_LEN)) {
        FTS_ERROR("host lcd init code len(%x) is too large", hlic_len);
        return -EINVAL;
    }

    initcode_checksum = cal_lcdinitcode_checksum(buf, hlic_len);
    buf_checksum = ((u16)((u16)buf[hlic_len - 2] << 8) + buf[hlic_len - 1]);
    FTS_INFO("lcd init code calc checksum:0x%04x,0x%04x", initcode_checksum, buf_checksum);
    if (initcode_checksum != buf_checksum) {
        FTS_ERROR("Initial Code checksum fail");
        return -EINVAL;
    }
    return 0;
}

/************************************************************************
 * fts_ft8607_upgrade_mode -
 * Return: return 0 if success, otherwise return error code
 ***********************************************************************/
static int fts_ft8607_upgrade_mode(enum FW_FLASH_MODE mode, u8 *buf, u32 len)
{
    int ret = 0;
    u32 start_addr = 0;
    u8 cmd[4] = { 0 };
    u32 delay = 0;
    int ecc_in_host = 0;
    int ecc_in_tp = 0;

    if ((NULL == buf) || (len < FTS_MIN_LEN)) {
        FTS_ERROR("buffer/len(%x) is invalid", len);
        return -EINVAL;
    }

    /* enter into upgrade environment */
    ret = fts_fwupg_enter_into_boot();
    if (ret < 0) {
        FTS_ERROR("enter into pramboot/bootloader fail,ret=%d", ret);
        goto fw_reset;
    }

    cmd[0] = FTS_CMD_FLASH_MODE;
    cmd[1] = FLASH_MODE_UPGRADE_VALUE;
    start_addr = upgrade_func_ft8607.appoff;
    if (FLASH_MODE_LIC == mode) {
        /* lcd initial code upgrade */
        ret = read_replace_3gamma(buf);
        if (ret < 0) {
            FTS_ERROR("replace 3-gamma fail, not upgrade lcd init code");
            goto fw_reset;
        }
        cmd[1] = FLASH_MODE_LIC_VALUE;
        start_addr = upgrade_func_ft8607.licoff;
    } else if (FLASH_MODE_PARAM == mode) {
        cmd[1] = FLASH_MODE_PARAM_VALUE;
        start_addr = upgrade_func_ft8607.paramcfgoff;
    }
    FTS_INFO("flash mode:0x%02x, start addr=0x%04x", cmd[1], start_addr);

    ret = fts_write(cmd, 2);
    if (ret < 0) {
        FTS_ERROR("upgrade mode(09) cmd write fail");
        goto fw_reset;
    }

    delay = FTS_ERASE_SECTOR_DELAY * (len / FTS_MAX_LEN_SECTOR);
    ret = fts_fwupg_erase(delay);
    if (ret < 0) {
        FTS_ERROR("erase cmd write fail");
        goto fw_reset;
    }

    /* write app */
    ecc_in_host = fts_flash_write_buf(start_addr, buf, len, 1);
    if (ecc_in_host < 0 ) {
        FTS_ERROR("lcd initial code write fail");
        goto fw_reset;
    }

    /* ecc */
    ecc_in_tp = fts_fwupg_ecc_cal(start_addr, len);
    if (ecc_in_tp < 0 ) {
        FTS_ERROR("ecc read fail");
        goto fw_reset;
    }

    FTS_INFO("ecc in tp:%x, host:%x", ecc_in_tp, ecc_in_host);
    if (ecc_in_tp != ecc_in_host) {
        FTS_ERROR("ecc check fail");
        goto fw_reset;
    }

    FTS_INFO("upgrade success, reset to normal boot");
    ret = fts_fwupg_reset_in_boot();
    if (ret < 0) {
        FTS_ERROR("reset to normal boot fail");
    }

    msleep(400);
    return 0;

fw_reset:
    return -EIO;
}


/*
 * fts_get_hlic_ver - read host lcd init code version
 *
 * return 0 if host lcd init code is valid, otherwise return error code
 */
static int fts_ft8607_get_hlic_ver(u8 *initcode)
{
    u8 *hlic_buf = initcode;
    u16 hlic_len = 0;
    u8 hlic_ver[2] = { 0 };

    hlic_len = ( (u16)(((u16)hlic_buf[0]) << 8) + hlic_buf[1]) * 2;
    FTS_INFO("host lcd init code len:%x", hlic_len);
    if ((hlic_len >= FTS_MAX_LEN_SECTOR) || (hlic_len <= FTS_MIN_LEN)) {
        FTS_ERROR("host lcd init code len(%x) is too large", hlic_len);
        return -EINVAL;
    }

    hlic_ver[0] = hlic_buf[hlic_len];
    hlic_ver[1] = hlic_buf[hlic_len + 1];

    FTS_INFO("host lcd init code ver:%x %x", hlic_ver[0], hlic_ver[1]);
    if (0xFF != (hlic_ver[0] + hlic_ver[1])) {
        FTS_ERROR("host lcd init code version check fail");
        return -EINVAL;
    }

    return hlic_ver[0];
}

/************************************************************************
* Name: fts_ft8607_upgrade
* Brief:
* Input:
* Output:
* Return: return 0 if success, otherwise return error code
***********************************************************************/
static int fts_ft8607_upgrade(u8 *buf, u32 len)
{
    int ret = 0;
    u8 *tmpbuf = NULL;
    u32 app_len = 0;

    FTS_INFO("fw app upgrade...");
    if (NULL == buf) {
        FTS_ERROR("fw buf is null");
        return -EINVAL;
    }

    if ((len < FTS_MIN_LEN) || (len > FTS_MAX_LEN_FILE)) {
        FTS_ERROR("fw buffer len(%x) fail", len);
        return -EINVAL;
    }

    app_len = len - upgrade_func_ft8607.appoff;
    tmpbuf = buf + upgrade_func_ft8607.appoff;
    ret = fts_ft8607_upgrade_mode(FLASH_MODE_APP, tmpbuf, app_len);
    if (ret < 0) {
        FTS_INFO("fw upgrade fail,reset to normal boot");
        if (fts_fwupg_reset_in_boot() < 0) {
            FTS_ERROR("reset to normal boot fail");
        }
        return ret;
    }

    return 0;
}

/************************************************************************
* Name: fts_ft8607_lic_upgrade
* Brief:
* Input:
* Output:
* Return: return 0 if success, otherwise return error code
***********************************************************************/
static int fts_ft8607_lic_upgrade(u8 *buf, u32 len)
{
    int ret = 0;
    u8 *tmpbuf = NULL;
    u32 lic_len = 0;

    FTS_INFO("lcd initial code upgrade...");
    if (NULL == buf) {
        FTS_ERROR("lcd initial code buffer is null");
        return -EINVAL;
    }

    if ((len < FTS_MIN_LEN) || (len > FTS_MAX_LEN_FILE)) {
        FTS_ERROR("lcd initial code buffer len(%x) fail", len);
        return -EINVAL;
    }

    ret = check_initial_code_valid(buf);
    if (ret < 0) {
        FTS_ERROR("initial code invalid, not upgrade lcd init code");
        return -EINVAL;
    }

    /* remalloc memory for initcode, need change content of initcode afterwise */
    lic_len = FTS_MAX_LEN_SECTOR;
    tmpbuf = kzalloc(lic_len, GFP_KERNEL);
    if (NULL == tmpbuf) {
        FTS_INFO("initial code buf malloc fail");
        return -EINVAL;
    }
    memcpy(tmpbuf, buf, lic_len);

    ret = fts_ft8607_upgrade_mode(FLASH_MODE_LIC, tmpbuf, lic_len);
    if (ret < 0) {
        FTS_INFO("lcd initial code upgrade fail,reset to normal boot");
        if (fts_fwupg_reset_in_boot() < 0) {
            FTS_ERROR("reset to normal boot fail");
        }
        if (tmpbuf) {
            kfree(tmpbuf);
            tmpbuf = NULL;
        }
        return ret;
    }

    if (tmpbuf) {
        kfree(tmpbuf);
        tmpbuf = NULL;
    }
    return 0;
}

/************************************************************************
 * Name: fts_ft8607_param_upgrade
 * Brief:
 * Input: buf - all.bin
 *        len - len of all.bin
 * Output:
 * Return: return 0 if success, otherwise return error code
 ***********************************************************************/
static int fts_ft8607_param_upgrade(u8 *buf, u32 len)
{
    int ret = 0;
    u8 *tmpbuf = NULL;
    u32 param_length = 0;

    FTS_INFO("parameter configure upgrade...");
    if (NULL == buf) {
        FTS_ERROR("fw file buffer is null");
        return -EINVAL;
    }

    if ((len < FTS_MIN_LEN) || (len > FTS_MAX_LEN_FILE)) {
        FTS_ERROR("fw file buffer len(%x) fail", len);
        return -EINVAL;
    }

    tmpbuf = buf + upgrade_func_ft8607.paramcfgoff;
    param_length = len - upgrade_func_ft8607.paramcfgoff;
    ret = fts_ft8607_upgrade_mode(FLASH_MODE_PARAM, tmpbuf, param_length);
    if (ret < 0) {
        FTS_INFO("fw upgrade fail,reset to normal boot");
        if (fts_fwupg_reset_in_boot() < 0) {
            FTS_ERROR("reset to normal boot fail");
        }
        return ret;
    }

    return 0;
}

struct upgrade_func upgrade_func_ft8607 = {
    .ctype = {0x09},
    .fwveroff = 0x110E,
    .fwcfgoff = 0x0780,
    .appoff = 0x1000,
    .licoff = 0x0000,
    .paramcfgoff = 0x11000,
    .paramcfgveroff = 0x11004,
    .pramboot_supported = true,
    .pramboot = pb_file_ft8607,
    .pb_length = sizeof(pb_file_ft8607),
    .hid_supported = false,
    .upgrade = fts_ft8607_upgrade,
    .get_hlic_ver = fts_ft8607_get_hlic_ver,
    .lic_upgrade = fts_ft8607_lic_upgrade,
    .param_upgrade = fts_ft8607_param_upgrade,
};
